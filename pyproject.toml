[tool.poetry]
name = "rdflib"
version = "6.3.0a0"
description = """RDFLib is a Python library for working with RDF, \
a simple yet powerful language for representing information."""
authors = ["Daniel 'eikeon' Krech <eikeon@eikeon.com>"]
maintainers = ["RDFLib Team <rdflib-dev@googlegroups.com>"]
repository = "https://github.com/RDFLib/rdflib"
documentation = "https://rdflib.readthedocs.org/"
license = "BSD-3-Clause"
classifiers=[
    "Programming Language :: Python",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.7",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "License :: OSI Approved :: BSD License",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Operating System :: OS Independent",
    "Natural Language :: English"
]
readme = "README.md"

[tool.poetry.scripts]
rdfpipe = 'rdflib.tools.rdfpipe:main'
csv2rdf = 'rdflib.tools.csv2rdf:main'
rdf2dot = 'rdflib.tools.rdf2dot:main'
rdfs2dot = 'rdflib.tools.rdfs2dot:main'
rdfgraphisomorphism = 'rdflib.tools.graphisomorphism:main'

[tool.poetry.dependencies]
python = "^3.7"
isodate = "^0.6.1"
pyparsing = "^3.0.9"
#setuptools  # not needed anymore?
importlib_metadata = {version = "^4.2.0", python = ">=3.7,<3.8"}
berkeleydb = {version = "^18.1.5", optional = true}
networkx = [
    {version = "^2.6.2", python = ">3.7,<3.8", optional = true},
    {version = "^2.8.8", python = "^3.8", optional = true},
]
html5lib = {version = "^1.1", optional = true}
black = {version = "22.12.0", optional = true}
flake8 = {version = ">=4.0.1", optional = true}  # flakeheaven is incompatible with flake8 >=5.0 (https://github.com/flakeheaven/flakeheaven/issues/132)
flakeheaven = {version = "^3.2.1", optional = true}
pep8-naming = {version = "^0.13.2", optional = true}
isort = {version = "^5.10.0", optional = true}
mypy = {version = "0.991", optional = true}
sphinx = {version = ">4.0.0", optional = true}
myst-parser = {version = "^0.18.0", optional = true}
sphinxcontrib-apidoc = {version = "^0.3.0", optional = true}
sphinxcontrib-kroki = {version = "^1.3.0", optional = true}
sphinx-autodoc-typehints = {version = "^1.17.1", optional = true}
pytest = {version = "^7.1.3", optional = true}
pytest-cov = {version = "^4.0.0", optional = true}
coverage = {version = "^7.0.1", extras = ["toml"], optional = true}

[tool.poetry.group.flake8.dependencies]
flake8 = ">=4.0.1" # flakeheaven is incompatible with flake8 >=5.0 (https://github.com/flakeheaven/flakeheaven/issues/132)
flakeheaven = "^3.2.1"
pep8-naming = "^0.13.2"

[tool.poetry.extras]
berkeleydb = ["berkeleydb"]
networkx = ["networkx"]
html = ["html5lib"]
dev = ["black", "flake8", "flakeheaven", "isort", "mypy", "pep8-naming"]
docs = [
    "sphinx",
    "myst-parser",
    "sphinxcontrib-apidoc",
    "sphinxcontrib-kroki",
    "sphinx-autodoc-typehints"
]
tests = ["html5lib", "pytest", "pytest-cov", "coverage"]

[build-system]
requires = ["poetry-core>=1.4.0"]
build-backend = "poetry.core.masonry.api"

[tool.flakeheaven]
format = "grouped"
baseline = ".flakeheaven.baseline"

[tool.flakeheaven.plugins]
pycodestyle = [
  "+*",
  # mirrored from setup.cfg
  "-E501",
  "-E203",
  "-W503",
  "-E231",
]
pyflakes = [
  "+*",
]
pep8-naming = ["+*"]

[tool.flakeheaven.exceptions."rdflib/plugins/sparql/*"]
pep8-naming = ["-N802", "-N803", "-N806", "-N812", "-N816", "-N801"]
[tool.flakeheaven.exceptions."rdflib/namespace/_*"]
pep8-naming = ["-N815"]
[tool.flakeheaven.exceptions."rdflib/plugins/parsers/notation3.py"]
pep8-naming = ["-N802", "-N803", "-N806", "-N816"]
[tool.flakeheaven.exceptions."rdflib/plugins/serializers/turtle.py"]
pep8-naming = ["-N802", "-N806", "-N815"]
[tool.flakeheaven.exceptions."rdflib/__init__.py"]
pycodestyle = ["-E402"]
[tool.flakeheaven.exceptions."test/utils/namespace/_*"]
pep8-naming = ["-N815"]


[tool.black]
required-version = "22.12.0"
line-length = "88"
target-version = ['py37']
include = '\.pyi?$'
exclude = '''
(
  /(
      \.eggs         # exclude a few common directories in the
    | \.git          # root of the project
    | \.hg
    | \.mypy_cache
    | \.pytest_cache
    | \.tox
    | \.venv
    | \.github
    | _build
    | htmlcov
    | benchmarks
    | examples       # No need to Black examples
    | test_reports
    | rdflib.egg-info
    | buck-out
    | build
    | dist
    | venv
  )/
)
'''

[tool.pytest.ini_options]
addopts = [
   "--doctest-modules",
   "--ignore=admin",
   "--ignore=devtools",
   "--ignore=rdflib/extras/external_graph_libs.py",
   "--ignore-glob=docs/*.py",
   "--doctest-glob=docs/*.rst",
]
doctest_optionflags = "ALLOW_UNICODE"
filterwarnings = [
    # The below warning is a consequence of how pytest doctest detects mocks and how DefinedNamespace behaves when an undefined attribute is being accessed.
    "ignore:Code. pytest_mock_example_attribute_that_shouldnt_exist is not defined in namespace .*:UserWarning",
    # The below warning is a consequence of how pytest detects fixtures and how DefinedNamespace behaves when an undefined attribute is being accessed.
    "ignore:Code. _pytestfixturefunction is not defined in namespace .*:UserWarning",
]
# log_cli = true
# log_cli_level = "DEBUG"
log_format = "%(asctime)s.%(msecs)03d %(levelname)-8s %(name)-12s %(filename)s:%(lineno)s:%(funcName)s %(message)s"
log_date_format = "%Y-%m-%dT%H:%M:%S"
log_cli_format = "%(asctime)s.%(msecs)03d %(levelname)-8s %(name)-12s %(filename)s:%(lineno)s:%(funcName)s %(message)s"
log_cli_date_format = "%Y-%m-%dT%H:%M:%S"

[tool.isort]
profile = "black"
py_version = 37
line_length = 88
src_paths= ["rdflib", "test"]
supported_extensions = ["pyw", "pyi", "py"]
skip = [
    '.eggs',         # exclude a few common directories in the
    '.git',          # root of the project
    '.hg',
    '.mypy_cache',
    '.pytest_cache',
    '.tox',
    '.venv',
    '.github',
    '_build',
    'htmlcov',
    'benchmarks',
    'examples',       # No need to Black examples
    'test_reports',
    'rdflib.egg-info',
    'buck-out',
    'build',
    'dist',
    'venv',
]

[tool.mypy]
files = ['rdflib', 'test', 'devtools']
python_version = "3.7"
warn_unused_configs = true
ignore_missing_imports = true
disallow_subclassing_any = false
warn_unreachable = true
warn_unused_ignores = true
no_implicit_optional = false

[[tool.mypy.overrides]]
module = "pyparsing.*"
# This is here because of an upstream issue with pyparsing:
# https://github.com/pyparsing/pyparsing/issues/385
# Once the issue is fixed this should be removed.
follow_imports = "skip"

[tool.coverage.run]
branch = true
source = ["rdflib"]
omit = ["*/_type_checking.py"]

[tool.coverage.report]
exclude_lines = [
    # Have to re-enable the standard pragma
    "pragma: no cover",

    # TYPE_CHECKING guarded code only affects type checkers.
    "^ *if (False|TYPE_CHECKING):",
    # constant used in protocols and abstract methods, does not run anything
    # and has no side effects.
    '^ +\.\.\.$',

    # Don't complain if non-runnable code isn't run:
    "if 0:",
    "if __name__ == .__main__.:",
    "if __name__==.__main__.:"
]
